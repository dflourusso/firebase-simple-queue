module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=3)}([function(t,e,r){t.exports=r(5)},function(t,e){t.exports=require("firebase-functions")},function(t,e){t.exports=require("firebase-admin")},function(t,e,r){t.exports=r(4)},function(t,e,r){"use strict";r.r(e);var n=r(0),o=r.n(n),u=r(1),a=r(2);function c(t,e,r,n,o,u,a){try{var c=t[u](a),i=c.value}catch(t){return void r(t)}c.done?e(i):Promise.resolve(i).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var u=t.apply(e,r);function a(t){c(u,n,o,a,i,"next",t)}function i(t){c(u,n,o,a,i,"throw",t)}a(void 0)})}}function s(t){var e="Error to process the task";return"[object Error]"===Object.prototype.toString.call(t)?e=t.message:"[object String]"===Object.prototype.toString.call(t)?e=t:void 0!==t&&null!==t&&(e=JSON.stringify(t)),{message:e,stack:t.stack||null}}e.default=function(t,e){var r=a.database().ref(t);function n(t){return c.apply(this,arguments)}function c(){return(c=i(o.a.mark(function t(n){var u,a,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",!1);case 2:return u=n.id,a=n.task,t.next=5,new Promise(function(t){return r.child("current").transaction(function(e){var r=e||u;return t(r),r})});case 5:if(t.sent==u){t.next=8;break}return t.abrupt("return",!1);case 8:return c={current:null},t.prev=9,t.next=12,e(a);case 12:c["tasks/".concat(u)]=null,t.next=19;break;case 15:t.prev=15,t.t0=t.catch(9),console.log("ERROR",t.t0),c["tasks/".concat(u,"/_error")]=s(t.t0);case 19:return t.next=21,r.update(c);case 21:return t.abrupt("return",!0);case 22:case"end":return t.stop()}},t,this,[[9,15]])}))).apply(this,arguments)}function f(){return l.apply(this,arguments)}function l(){return(l=i(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n,t.next=3,r.child("tasks").orderByChild("_error").equalTo(null).limitToFirst(1).once("value").then(function(t){return t.val()}).then(function(t){if(!t)return null;var e=Object.keys(t).pop();return{id:e,task:t[e]}});case 3:return t.t1=t.sent,t.next=6,(0,t.t0)(t.t1);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}return{onCreateTask:u.database.ref("/".concat(t,"/tasks/{id}")).onCreate(f),onFinishTask:u.database.ref("/".concat(t,"/current")).onDelete(f),onRetryTask:u.database.ref("/".concat(t,"/tasks/{id}/_error")).onDelete(f)}}},function(t,e){t.exports=require("regenerator-runtime")}]);